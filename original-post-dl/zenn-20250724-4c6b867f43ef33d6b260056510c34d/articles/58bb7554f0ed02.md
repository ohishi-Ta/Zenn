---
title: "ã€Terraformã€‘ALBã®ä½œæˆ"
emoji: "ğŸ’­"
type: "tech"
topics:
  - "aws"
  - "terraform"
  - "alb"
  - "elb"
published: true
published_at: "2025-01-13 18:24"
---

## ã¯ã˜ã‚ã«
ä¸‹è¨˜ã®ELBã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/ea441463a7c6-20250113.png)

## ALBã®ä½œæˆ
### aws_lb
1. name : string : ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼å
2. internal : bool : å†…éƒ¨å‘ã‘ã‹ã©ã†ã‹
3. load_balancer_type : enum :application,network,gateway
4. security_gropups : string[] : ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—
5. subnet : string[] : ã‚µãƒ–ãƒãƒƒãƒˆ
6. tags : object : ã‚¿ã‚°
```HCL:alb.tf
#------------------
#ALB
#------------------
resource "aws_alb" "alb" {
  name               = "${var.project}-${var.environment}-web-sg"
  internal           = false
  load_balancer_type = "application"
  security_groups = [
    aws_security_group.web_sg
  ]
  subnets = [aws_subnet.private_subnet_1a.id, aws_subnet.private_subnet_1c.id]
}
```
## ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã¨ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆã®ä½œæˆ
### aws_lb_target_group
1. name : string : ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼å
2. port : number : ãƒãƒ¼ãƒˆç•ªå·
3. protocol : enum : HTTP,HTTPS,TCP,UDP,TCP_UDP
4. vpc_id : string[] : VPC ID
5. tags : object : ã‚¿ã‚°
### aws_lb_target_group_attachment
1. target_group_arn : string : æ‰€å±ã•ã›ãŸã„ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ARN
2. target_id : string : æ‰€å±ã•ã›ãŸã„EC2ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID
```HCL:alb.tf
#------------------
#target group
#------------------
resource "aws_lb_target_group" "alb_target_group" {
  name               = "${var.project}-${var.environment}-app-tg"
  port = 3000
  protocol = "HTTP"
  vpc_id = aws_vpc.vpc.id

  tags = {
    Name    = "${var.project}-${var.environment}-app-tg"
    Project = var.project
    Env     = var.environment
  }
}

resource "aws_lb_target_group_attachment" "instance" {
    target_group_arn = aws_lb_target_group.alb_target_group.arn
    target_id = aws_instance.app_server.id
}
```

## ãƒªã‚¹ãƒŠãƒ¼ã®ä½œæˆ
### aws_lb_listenerï¼ˆHTTPï¼‰
1. load_balancer_arn : string : ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ARN
2. port : number : ãƒãƒ¼ãƒˆç•ªå·ï¼ˆ80,443ï¼‰
3. protcol : enum : HTTP
4. default_action : block :typeï¼ˆforward,redirectãªã©ï¼‰,target_group_arnï¼ˆforwardã™ã‚‹éš›ã®è»¢é€å…ˆï¼‰
```HCL:alb.tf
#------------------
#listener
#------------------
resource "aws_lb_listener" "alb_listener_http" {
  load_balancer_arn = aws_lb.alb.arn
  port = 80
  protocol = "HTTP"

  default_action {
    type = "forward"
    target_group_arn = aws_lb_target_group.alb_target_group.arn
  }
}
```

### aws_lb_listenerï¼ˆHTTPSï¼‰
ACMã®è¨¼æ˜æ›¸ãŒå¿…è¦ã€‚
1. ssl_policy
2. certificate_arn

ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ALBãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã€‚