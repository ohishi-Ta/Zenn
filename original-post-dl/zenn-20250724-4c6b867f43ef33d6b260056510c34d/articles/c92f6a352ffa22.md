---
title: "ã€Terraformã€‘VPCã¨ã‚µãƒ–ãƒãƒƒãƒˆã®ä½œæˆ"
emoji: "ğŸ¦”"
type: "tech"
topics:
  - "aws"
  - "terraform"
published: true
published_at: "2025-01-11 15:09"

---

## ã¯ã˜ã‚ã«
Terraformã§VPCã¨ã‚µãƒ–ãƒãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/2ed25b9e40d5-20250111.png)
## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
.
â”œâ”€â”€ main.tf
â”œâ”€â”€ network.tf
â””â”€â”€ terraform.tfvars
```

## main.tfã¨terraform.tfvars
```HCL:main.tf
#------------------
# Terraform configuration
#------------------
terraform {
  #0.13ä»¥ä¸Š
  required_version = ">=0.13"
  required_providers {
    aws = {
      source = "hashicorp/aws"
      #ãŠãŠã‚ˆã3.0ä»¥ä¸Šï¼ˆãƒã‚¤ãƒŠãƒ¼ã¯æ°—ã«ã—ãªã„ï¼‰
      version = "~> 3.0"
    }
  }
}

#------------------
# Provider
#------------------
provider "aws" {
  profile = "ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
  region  = "ap-northeast-1"
}

#------------------
# Variables
#------------------
variable "project" {
  type = string
}
variable "environment" {
  type = string
}
```

```HCL:terraform.tfvars
project     = "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå"
environment = "dev"
```


## VPC
1. cidr_block : string : IPv4 CIDRãƒ–ãƒ­ãƒƒã‚¯
2. assign_generated_ipv6_cidr_block : string : IPv6 CIDRãƒ–ãƒ­ãƒƒã‚¯
3. instance_tenancy : enum : ãƒ†ãƒŠãƒ³ã‚·ãƒ¼ï¼ˆdefault,dedicatedï¼‰
4. enable_dns_support : bool : DNSè§£æ±º
5. enable_dns_hostnames : bool : DNSãƒ›ã‚¹ãƒˆå
6. tags : object : ã‚¿ã‚°

```HCL:network.tf
#------------------
#VPC
#------------------
resource "aws_vpc" "vpc" {
  cidr_block = "192.168.0.0/20"
  instance_tenancy  = "default"
  enable_dns_support = true
  enable_dns_hostnames = true
  assign_generated_ipv6_cidr_block = false

  tags = {
    Name    = "${var.project}-${var.environment}-vpc"
    Project = var.project
    Env     = var.environment
  }
}
```

## ã‚µãƒ–ãƒãƒƒãƒˆ
1. vpc_id : string : VPC ID
2. availability_zone : string : ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚¾ãƒ¼ãƒ³
3. cidr_block : string : CIDRãƒ–ãƒ­ãƒƒã‚¯
4. map_public_ip_on_launch : bool : è‡ªå‹•å‰²ã‚Šå½“ã¦IPè¨­å®š
5. tags : object : ã‚¿ã‚°
```HCL:network.tf
#------------------
#Subnet
#------------------

#ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆ
resource "aws_subnet" "public_subnet_1a" {
  vpc_id                  = aws_vpc.vpc.id
  availability_zone       = "ap-northeast-1a"
  cidr_block              = "192.168.1.0/24"
  map_public_ip_on_launch = true
  tags = {
    Name    = "${var.project}-${var.environment}-private-subnet-1a"
    Project = var.project
    Env     = var.environment
    Type    = "public"
  }
}

#ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆ
resource "aws_subnet" "private_subnet_1a" {
  vpc_id                  = aws_vpc.vpc.id
  availability_zone       = "ap-northeast-1a"
  cidr_block              = "192.168.2.0/24"
  map_public_ip_on_launch = false
  tags = {
    Name    = "${var.project}-${var.environment}-private-subnet-1a"
    Project = var.project
    Env     = var.environment
    Type    = "private"
  }
}
```


## ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«
ä¸‹è¨˜ï¼’ã¤ã‚’è¨­å®šã€‚
### aws_route_table
çµŒè·¯æƒ…å ±ã‚’æ ¼ç´ã™ã‚‹ç®±ã§ã™ã€‚
1. vpc_id : string : VPC ID
2. tags : object : ã‚¿ã‚°
### aws_route
çµŒè·¯æƒ…å ±ã‚’aws_route_tableã¸è¿½åŠ ã—ã¾ã™ã€‚
1. route_table_id : string : ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ID
2. destination_cidr_block : string : é€ä¿¡å…ˆ
3. gateway_id : string : ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ID
### aws_route_table_association
aws_route_tableã¨aws_subnetã‚’ç´ã¥ã‘ã¾ã™ã€‚
1. route_table_id : string : ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ID
2. subnet_id : string : ã‚µãƒ–ãƒãƒƒãƒˆID
```HCL:network.tf
#------------------
#Route Table
#------------------

resource "aws_route_table" "public_rt" {
  vpc_id = aws_vpc.vpc.id
  tags = {
    Name    = "${var.project}-${var.environment}-public-rt"
    Project = var.project
    Env     = var.environment
    Type    = "public"
  }
}

resource "aws_route_table_association" "public_rt_1a" {
  route_table_id = aws_route_table.public_rt.id
  subnet_id      = aws_subnet.public_subnet_1a.id
}

resource "aws_route_table" "private_rt" {
  vpc_id = aws_vpc.vpc.id
  tags = {
    Name    = "${var.project}-${var.environment}-private-rt"
    Project = var.project
    Env     = var.environment
    Type    = "private"
  }
}

resource "aws_route_table_association" "private_rt_1a" {
  route_table_id = aws_route_table.private_rt.id
  subnet_id      = aws_subnet.private_subnet_1a.id
}
```
## ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤
ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ç¹‹ã’ã‚‹ã€‚
### aws_internet_gateway
1. vpc_id : string : VPC ID
2. tags : object : ã‚¿ã‚°

```HCL:network.tf
#------------------
#Internet Gateway
#------------------
resource "aws_internet_gateway" "igw" {
  vpc_id = aws_vpc.vpc.id

  tags = {
    Name    = "${var.project}-${var.environment}-igw"
    Project = var.project
    Env     = var.environment
  }
}

resource "aws_route" "public_rt_igw_r" {
  route_table_id         = aws_route_table.public_rt.id
  destination_cidr_block = "0.0.0.0/0"
  gateway_id             = aws_internet_gateway.igw.id
}
```
     