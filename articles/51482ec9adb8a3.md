---
title: "CloudFront・ALB・ECS・Fargate・NginxでWebサイト作成②"
emoji: "👏"
type: "tech"
topics:
  - "aws"
  - "cloudfront"
  - "alb"
  - "route53"
  - "acm"
published: true
published_at: "2025-01-18 23:13"
---

## はじめに
前回作成した、HTTPでアクセスする構成をACMで証明書を発行し、HTTPSでアクセスできるようにしていきます。
![](https://storage.googleapis.com/zenn-user-upload/4a53180ede5d-20250119.png)
### 前提条件
- ドメインはお名前.comで作成し、Route53にホストゾーンを作成し、NSレコードを登録します
    - [パブリックホストゾーンで購入したドメイン名を指定。](https://zenn.dev/t_oishi/articles/86c775ae336672#%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%81%AE%E7%99%BB%E9%8C%B2)
- albのセキュリティグループのインバウンドにHTTPSを追加

## ACMで証明書の作成
①クライアント→CloudFront、②CloudFront→ALBの通信をHTTPSにするには、証明書が2つ必要。
①のCloudFrontで使用するには、バージニア北部リージョン（us-east-1）で作成しなければいけません。

まず東京リージョンから作成していきます。
- ACM管理コンソールのリクエストから**パブリック証明書をリクエスト**を選択
- **完全修飾ドメイン名**に`example.com`,`*.example.com`を入力
- DNS検証を選択し、リクエスト
※リクエストをクリックした後、CNAMEが追加されないとステータスが`保留中の検証`のまま変わらない
- **Route 53 でレコードを作成**をクリックし、CNAMEを追加
- CNAMEが追記されたか確認する方法
    - Route53で確認
    - digコマンドで確認
```
$ dig _example.example.com. +short
```
- ステータスが成功になったら成功（少し待ち時間がある）

**バージニア北部リージョン**でも同様に作成。
- CNAMEは既に作成されているので、すぐに成功します

## CloudFrontの編集
HTTPの設定になっているので、HTTPSに設定していきます。オリジンドメインの変更も行います。
### 設定の変更
- **一般タブ**の**代替ドメイン名**を編集し、`example.com`に設定します
- **オリジンタブ**の**オリジンドメイン**を編集し、`example.com`に設定します
- **オリジンタブ**の**デフォルト**を編集し、`HTTPSのみ`に設定します
※オリジンドメインは独自ドメインを入力しない！！ALBを設定！
- クライアントからCloudFrontの通信をHTTPSのみにする為**ビヘイビアタブ**の**デフォルト**を`HTTPからHTTPSにリダイレクト`に設定する
## Route53の編集
CloudFrontディストリビューションにドメインを設定するRoute 53のレコードを編集していきます。
- **レコード名**は空（サブドメインをつけない為）
- **レコードタイプ**はAレコードを選択
- **エイリアス**をオン
- **CloudFrontのエンドポイント**を選択し、ディストリビューションを選択

## ALBの編集
ALBの**リスナーとルール**をHTTPSに編集します。
- **プロトコル**をHTTPSに変更
- **証明書**を東京リージョンで作成したものを選択


これで独自ドメインにアクセスしHTTPSで閲覧できれば成功！
