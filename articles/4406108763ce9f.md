---
title: "ã€AWS Service Catalogã€‘æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‚’è‡ªå‹•åŒ–+SSOã§è¨­å®šã—ã¦ã¿ãŸ"
emoji: "ğŸ“‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "aws"
  - "servicecatalog"
  - "cloudformation"
  - "iamidentitycenter"
  - "organizations"
published: true
published_at: "2025-10-15 15:00"
---
# ã¯ã˜ã‚ã«
ã‚µãƒ¼ãƒ“ã‚¹ãªã©ã‚’`SaaS`åŒ–ã™ã‚‹éš›ã«ã€ãŠå®¢æ§˜ã”ã¨ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã€ãã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ§‹æˆã¯ã‚ˆãã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ãã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‚’`Service Catalog`ã‚’ä½¿ç”¨ã—ã¦ã€è‡ªå‹•åŒ–ã§ããªã„ã‹ã¨æ€ã„ã€æ¤œè¨¼ã—ã¦ã¿ã¾ã—ãŸã€‚
ã¾ãŸã€ãã‚Œã‚‰ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã¯`IAM Identity Center`ã‚’ä½¿ç”¨ã—ã¦ã€`SSO`ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚

# å‰ææ¡ä»¶
- ç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã“ã¨
    - ä»Šå›ã¯`AdministratorAccessãƒãƒªã‚·ãƒ¼`ã‚’ä»˜ä¸ã—ã¦ã„ã¾ã™   
- `Organizations`ãŒè¨­å®šã—ã¦ã‚ã‚‹ã“ã¨
- `IAM Identity Center`ã‚’æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§æœ‰åŠ¹åŒ–ã—ã¦ã‚ã‚‹ã“ã¨

# å®Ÿè£…
## Service Catalogã§è£½å“ã‚’ä½œæˆ
Service Catalogã®è¨­å®šæ–¹æ³•ã¯ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„ã€‚
https://zenn.dev/t_oishi/articles/26a1871037c8b9

ä»Šå›ã¯ä»¥ä¸‹ã®ã‚ˆã†ãª7ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚
- æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åå‰
    - **AccountName**: "é–‹ç™ºç’°å¢ƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆ"
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç”¨ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
    - **AccountEmail**: "aws-dev-team@example.com"
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é…ç½®ã™ã‚‹OUï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    - **OrganizationalUnitId**: "ou-abc1-23456789"
- IAM Identity Centerã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ARN
    - **IdentityCenterInstanceArn**: "arn:aws:sso:::instance/ssoins-1234567890abcdef"
- å‰²ã‚Šå½“ã¦ã‚‹æ¨©é™ã‚»ãƒƒãƒˆã®ARN
    - **PermissionSetArn**: "arn:aws:sso:::permissionSet/ssoins-1234567890abcdef/ps-abcdef1234567890"
- ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä»˜ä¸ã™ã‚‹å¯¾è±¡ã®ã‚¿ã‚¤ãƒ—
    - **PrincipalType**: "User/GROUP"
- ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ã‚°ãƒ«ãƒ¼ãƒ—ID
    - **PrincipalId**: "xxxxx-e5f6-7890-abcd-ef1234567890"

![](https://storage.googleapis.com/zenn-user-upload/09e4c70f6498-20251015.png)

```yml:create-account-parameter.yml
AWSTemplateFormatVersion: '2010-09-09'
Description: 'AWS Organizations Account Creation with IAM Identity Center Integration via Service Catalog'

Parameters:
  AccountName:
    Type: String
    Description: 'Name of the new AWS account'
    MinLength: 1
    MaxLength: 50
    AllowedPattern: '[\w\s\-]+'
    ConstraintDescription: 'Account name must contain only alphanumeric characters, spaces, and hyphens'

  AccountEmail:
    Type: String
    Description: 'Email address for the new account (must be unique)'
    AllowedPattern: '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'
    ConstraintDescription: 'Must be a valid email address'

  OrganizationalUnitId:
    Type: String
    Description: 'Organizational Unit ID where the account will be created (e.g., ou-xxxx-xxxxxxxx)'
    Default: ''
    AllowedPattern: '^(ou-[a-z0-9]{4,32}-[a-z0-9]{8,32}|r-[a-z0-9]{4,32})?$'

  IdentityCenterInstanceArn:
    Type: String
    Description: 'IAM Identity Center Instance ARN (e.g., arn:aws:sso:::instance/ssoins-xxxxxxxx)'
    AllowedPattern: '^arn:aws:sso:::instance/ssoins-[a-z0-9]{16}$'

  PermissionSetArn:
    Type: String
    Description: 'Permission Set ARN to assign (e.g., arn:aws:sso:::permissionSet/ssoins-xxxxx/ps-xxxxx)'
    AllowedPattern: '^arn:aws:sso:::permissionSet/ssoins-[a-z0-9]{16}/ps-[a-z0-9]{16}$'

  PrincipalType:
    Type: String
    Description: 'Type of principal to assign access'
    Default: 'GROUP'
    AllowedValues:
      - USER
      - GROUP

  PrincipalId:
    Type: String
    Description: 'Principal ID (User ID or Group ID) from IAM Identity Center'
    AllowedPattern: '^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$'
    ConstraintDescription: 'Must be a valid UUID format'

Conditions:
  HasOrganizationalUnit: !Not [!Equals [!Ref OrganizationalUnitId, '']]

Resources:
  NewAccount:
    Type: AWS::Organizations::Account
    Properties:
      AccountName: !Ref AccountName
      Email: !Ref AccountEmail
      ParentIds:
        - !If
          - HasOrganizationalUnit
          - !Ref OrganizationalUnitId
          - !Ref AWS::NoValue
      Tags:
        - Key: ManagedBy
          Value: ServiceCatalog
        - Key: CreatedDate
          Value: !Sub '${AWS::StackName}'
        - Key: Environment
          Value: 'Production'

  # IAM Identity Center ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰²ã‚Šå½“ã¦
  SSOAccountAssignment:
    Type: AWS::SSO::Assignment
    DependsOn: NewAccount
    Properties:
      InstanceArn: !Ref IdentityCenterInstanceArn
      PermissionSetArn: !Ref PermissionSetArn
      PrincipalId: !Ref PrincipalId
      PrincipalType: !Ref PrincipalType
      TargetId: !GetAtt NewAccount.AccountId
      TargetType: AWS_ACCOUNT

Outputs:
  AccountId:
    Description: 'New AWS Account ID'
    Value: !GetAtt NewAccount.AccountId
    Export:
      Name: !Sub '${AWS::StackName}-AccountId'

  AccountName:
    Description: 'Account Name'
    Value: !Ref AccountName
    Export:
      Name: !Sub '${AWS::StackName}-AccountName'

  AccountEmail:
    Description: 'Account Email'
    Value: !Ref AccountEmail

  AssignmentDetails:
    Description: 'IAM Identity Center Assignment Details'
    Value: !Sub |
      Principal Type: ${PrincipalType}
      Principal ID: ${PrincipalId}
      Permission Set: ${PermissionSetArn}
      Target Account: ${NewAccount.AccountId}

  AccessInstructions:
    Description: 'How to access the new account'
    Value: |
      1. Go to your AWS Access Portal URL
      2. Sign in with your IAM Identity Center credentials
      3. Select the new account from the list
      4. Click 'Management console' to access the account
```

## IAM Identity Centerã®è¨­å®š
ã¾ãšãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚
ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã¯ã©ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’SSOã®å¯¾è±¡ã«ã—ã€ç®¡ç†ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ã‚‚ã®ã§ã™ã€‚
https://techblog.ap-com.co.jp/entry/2023/11/12/033453

![](https://storage.googleapis.com/zenn-user-upload/a9dd815711e3-20251015.png)

è¨­å®šãŒå®Œäº†ã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ¡ãƒ¼ãƒ«ãŒé€ã‚‰ã‚Œã¦ãã¾ã™ã€‚
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„MFAè¨­å®šã‚’ã—ã¾ã—ã‚‡ã†ã€‚
![](https://storage.googleapis.com/zenn-user-upload/24ad20b909ec-20251015.png)

ãã†ã™ã‚‹ã¨`https://d-xxxxxx.awsapps.com/start/`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ­ã‚°ã‚¤ãƒ³ãŒã§ããŸã‚‰SSOç”»é¢ã«ç§»ã‚‹ã¯ãšã§ã™ã€‚

æ¬¡ã«ã€è¨±å¯ã‚»ãƒƒãƒˆã®è¨­å®šã‚’ã—ã¾ã™ã€‚
ã“ã‚Œã¯ã€SSOã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹éš›ã«ã©ã®æ¨©é™ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‹è¨­å®šã™ã‚‹ã‚‚ã®ã§ã™ã€‚
ä»Šå›ã¯`AdministratorAccess`ã‚’ä½œæˆã—ã¦ãŠãã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/4c352e136b8c-20251015.png)

ã“ã‚Œã§IAM Identity Centerã®è¨­å®šã¯å®Œäº†ã§ã™ã€‚

ã‚°ãƒ«ãƒ¼ãƒ—ã¯ä»»æ„ã§ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã„ã‚‹å ´åˆã«ä½œæˆã™ã‚‹ã“ã¨ã§ã€è¤‡æ•°ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## è£½å“ã®èµ·å‹•
ã§ã¯å…ˆã»ã©ä½œæˆã—ãŸè£½å“ã‚’èµ·å‹•ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

å•é¡Œãªãä½œæˆã§ãã‚Œã°ã€Organizetionsã¸ã‚‚åæ˜ ã•ã‚Œã€SSOç”»é¢ã‹ã‚‰ã‚‚ãƒ­ã‚°ã‚¤ãƒ³ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/ffe4387cf8e4-20251015.png)

