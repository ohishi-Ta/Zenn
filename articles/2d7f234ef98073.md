---
title: "ã€Amazon Bedrockãƒ»SAMã€‘Zennã®.mdãƒ•ã‚¡ã‚¤ãƒ«è¨˜äº‹ã‚’AIã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹VScordæ‹¡å¼µæ©Ÿèƒ½ã‚’ã¤ãã£ã¦ã¿ãŸ"
emoji: "ğŸ“š"
type: "tech"
topics:
  - "aws"
  - "bedrock"
  - "ai"
  - "sam"
  - "zenn"
published: true
published_at: "2025-09-05 18:00"
---

# ã¯ã˜ã‚ã«
æ—¥ã”ã‚`Zenn`ã®è¨˜äº‹ã‚’æ›¸ã„ãŸå¾Œã€æŠ•ç¨¿å‰ã«è¦‹ç›´ã—ã‚’ã—ã¦èª¤å­—ã‚„è„±å­—ã‚’ã—ãªã„ã‚ˆã†åŠªã‚ã¦ã„ã¾ã™ãŒã€ã©ã†ã—ã¦ã‚‚è¦‹é€ƒã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
`ChatGPT`ãªã©ã«å¼µã‚Šä»˜ã‘ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã‚‚ã‚‰ãˆã‚Œã°æ¸ˆã‚€è©±ã§ã¯ã‚ã‚Šã¾ã™ãŒã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›¸ã„ã¦è²¼ã‚Šä»˜ã‘ã¦ã®ä½œæ¥­ãªã©æ¯å›è¡Œã†ä½œæ¥­ã¯è‡ªå‹•åŒ–ã—ãŸã„ã‚‚ã®ã§ã™ã€‚
ãã“ã§ä¸‹è¨˜ã®è¨˜äº‹ã‚’è¦‹ã¤ã‘ã€å‚è€ƒã«ã—ã¦å®Ÿéš›ã«ä½œæˆã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
æœ€çµ‚çš„ã«`VScordæ‹¡å¼µæ©Ÿèƒ½`ã§å‹•ä½œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

https://dev.classmethod.jp/articles/create-blog-review-api-with-bedrock/

# å®Ÿè£…
å„ç¨®ãƒªã‚½ãƒ¼ã‚¹ã¯SAMã‚’ä½¿ã£ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
AWS CLIã¯è¨­å®šã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

### template.yamlã«ã¤ã„ã¦
AWS SAMã®ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å…¨ä½“ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### 1. API Gatewayé–¢é€£
- **Api**: REST APIã®å®šç¾©
  - OpenAPIä»•æ§˜æ›¸ï¼ˆoas.yamlï¼‰ã‚’å‚ç…§
  - ç’°å¢ƒã«å¿œã˜ãŸã‚¹ãƒ†ãƒ¼ã‚¸åã‚’è¨­å®š

- **BlogReviewUsagePlan**: APIä½¿ç”¨é‡ãƒ—ãƒ©ãƒ³
  - 1æ—¥ã‚ãŸã‚Š1000ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åˆ¶é™
  - ãƒ¬ãƒ¼ãƒˆåˆ¶é™: 10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’
  - ãƒãƒ¼ã‚¹ãƒˆåˆ¶é™: 20ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

- **BlogReviewApiKey**: APIã‚­ãƒ¼
  - APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹èªè¨¼ç”¨

- **BlogReviewUsagePlanKey**: APIã‚­ãƒ¼ã¨ä½¿ç”¨é‡ãƒ—ãƒ©ãƒ³ã®é–¢é€£ä»˜ã‘

#### 2. IAMãƒ­ãƒ¼ãƒ«
- **ApiGwRole**: API Gatewayç”¨ãƒ­ãƒ¼ãƒ«
  - Step Functionsã®åŒæœŸå®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸

- **BlogReviewStateMachineRole**: Step Functionsç”¨ãƒ­ãƒ¼ãƒ«
  - CloudWatch Logsã¸ã®ãƒ•ãƒ«ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
  - Bedrockï¼ˆAIï¼‰ãƒ¢ãƒ‡ãƒ«ã®å‘¼ã³å‡ºã—æ¨©é™

#### 3. Step Functions
- **BlogReviewStateMachine**: ãƒ–ãƒ­ã‚°ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³
  - ã‚¿ã‚¤ãƒ—: EXPRESSï¼ˆåŒæœŸå®Ÿè¡Œï¼‰
  - å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«: blog-review.asl.yaml
  - ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã¨ãƒ­ã‚®ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–

#### 4. ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—
- **BlogReviewStateMachineLog**: Step Functionså®Ÿè¡Œãƒ­ã‚°
  - ä¿æŒæœŸé–“: 30æ—¥

#### Outputsï¼ˆå‡ºåŠ›ï¼‰
- **ApiUrl**: ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸAPIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURL
- **ApiKeyId**: ä½œæˆã•ã‚ŒãŸAPIã‚­ãƒ¼ã®ID

```yaml:template.yaml
AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Parameters:
  Environment:
    Type: String
    Default: dev
    AllowedValues:
      - dev
      - stg      
      - prd
Resources:
  Api:
    Type: AWS::Serverless::Api
    Properties:
      StageName: !Ref Environment
      DefinitionBody:
        Fn::Transform:
          Name: AWS::Include
          Parameters:
            Location: oas.yaml

  # Usage Plan ã‚’åˆ¥ãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½œæˆ
  BlogReviewUsagePlan:
    Type: AWS::ApiGateway::UsagePlan
    DependsOn: Api
    Properties:
      UsagePlanName: !Sub ${Environment}-blog-review-usage-plan
      Description: !Sub ${Environment} ãƒ–ãƒ­ã‚°è‡ªå‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼APIç”¨ä½¿ç”¨æ–™ãƒ—ãƒ©ãƒ³
      Quota:
        Limit: 1000
        Period: DAY
      Throttle:
        RateLimit: 10
        BurstLimit: 20
      ApiStages:
        - ApiId: !Ref Api
          Stage: !Ref Environment

  # API Key
  BlogReviewApiKey:
    Type: AWS::ApiGateway::ApiKey
    Properties:
      Name: !Sub ${Environment}-blog-review-api-key
      Enabled: true

  # Usage Plan Key ã®é–¢é€£ä»˜ã‘
  BlogReviewUsagePlanKey:
    Type: AWS::ApiGateway::UsagePlanKey
    Properties:
      KeyId: !Ref BlogReviewApiKey
      KeyType: API_KEY
      UsagePlanId: !Ref BlogReviewUsagePlan

  ApiGwRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - apigateway.amazonaws.com
            Action:
              - sts:AssumeRole
      Path: /
      Policies:
        - PolicyName: sfn-integration
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
            - Effect: Allow
              Action:
              - states:StartSyncExecution
              Resource: '*'

  BlogReviewStateMachine:
    Type: AWS::Serverless::StateMachine
    Properties:
      Name: !Sub "${Environment}-blog-review"
      Type: EXPRESS
      DefinitionUri: blog-review.asl.yaml
      DefinitionSubstitutions:
        Environment: !Ref Environment
      Role: !GetAtt BlogReviewStateMachineRole.Arn
      Tracing:
        Enabled: true
      Logging:
        Level: ALL
        IncludeExecutionData: True
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn: !GetAtt BlogReviewStateMachineLog.Arn

  BlogReviewStateMachineLog:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName : !Sub "/aws/states/${Environment}-blog-review-api"
      RetentionInDays: 30

  BlogReviewStateMachineRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - states.amazonaws.com
            Action:
              - sts:AssumeRole
      Path: /
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/CloudWatchLogsFullAccess
      Policies:
        - PolicyName: bedrock
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
            - Effect: Allow
              Action:
              - bedrock:InvokeModel
              Resource: '*'

Outputs:
  ApiUrl:
    Description: API Gateway URL
    Value: !Sub 'https://${Api}.execute-api.${AWS::Region}.amazonaws.com/${Environment}'
  ApiKeyId:
    Description: API Key ID
    Value: !Ref BlogReviewApiKey
```

### oas.yamlã«ã¤ã„ã¦
API Gatewayã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä»•æ§˜ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚

#### APIä»•æ§˜
#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- APIã‚­ãƒ¼èªè¨¼ï¼ˆx-api-key ãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ãŒå¿…é ˆ

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜
```json
{
  "article": "ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹è¨˜äº‹ã®æœ¬æ–‡ï¼ˆæ–‡å­—åˆ—ï¼‰"
}
```
- articleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¿…é ˆ
- æœ€å°æ–‡å­—æ•°: 1æ–‡å­—

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä»•æ§˜
```json
{
  "typo": "èª¤å­—è„±å­—ãƒã‚§ãƒƒã‚¯çµæœ",
  "mediaPolicy": "ãƒ¡ãƒ‡ã‚£ã‚¢ãƒãƒªã‚·ãƒ¼ãƒã‚§ãƒƒã‚¯çµæœ"
}
```

#### API Gatewayçµ±åˆè¨­å®š

#### Step Functionsã¨ã®çµ±åˆ
- çµ±åˆã‚¿ã‚¤ãƒ—: AWS ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆ
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: StartSyncExecutionï¼ˆåŒæœŸå®Ÿè¡Œï¼‰
- IAMãƒ­ãƒ¼ãƒ«: ApiGwRoleã‚’ä½¿ç”¨

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¤‰æ›
- å—ä¿¡ã—ãŸJSONã‚’Step Functionsã®å…¥åŠ›å½¢å¼ã«å¤‰æ›
- ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ARNã‚’å‹•çš„ã«å–å¾—

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›
- Step Functionså®Ÿè¡Œçµæœã‚’APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¤‰æ›
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯500ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”å´

```yaml:oas.yaml
openapi: 3.0.1
info:
  title:
    Fn::Sub: ${Environment} Blog Review API
  version: '1.0'
x-amazon-apigateway-request-validators:
  body-only:
    validateRequestBody: true
    validateRequestParameters: false
x-amazon-apigateway-request-validator: body-only
paths:
  /review:
    post:
      security:
        - api_key: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                article:
                  type: string
                  # 1æ–‡å­—ã ã‘ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã‚‚æœ‰åŠ¹ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ã‚‚ã‚‰ãˆãªã„ã®ã§ã€æœ¬æ¥ã¯ã‚‚ã£ã¨æ¡æ•°ã‚’å¤§ããã—ãŸæ–¹ãŒè‰¯ã„
                  minLength: 1
                  # TODO maxLengthã‚‚è¨­å®šã™ã‚‹
                  nullable: false
              required:
                - article
      responses:
        '200':
          description: Review created
          content:
            application/json:
              schema:
                type: object
                properties:
                  typo:
                    type: string
                    example: ã‚¿ã‚¤ãƒè­¦å¯Ÿã ï¼                    
                  mediaPolicy:
                    type: string
                    example: ç‰¹ã«å•é¡Œã‚ã‚Šã¾ã›ã‚“
      x-amazon-apigateway-integration:
        credentials: 
          Fn::GetAtt: ApiGwRole.Arn
        httpMethod: "POST"
        uri:
          Fn::Sub: "arn:aws:apigateway:${AWS::Region}:states:action/StartSyncExecution"
        responses:
          200:
            statusCode: "200"
            responseTemplates:
              application/json: |
                #set($inputRoot = $input.path('$'))
                #if($input.path('$.status').toString().equals("FAILED"))
                  #set($context.responseOverride.status = 500)
                  {
                    "error": "$input.path('$.error')",
                    "cause": "$input.path('$.cause')"
                  }
                  #else
                    $input.path('$.output')
                  #end
        requestTemplates:
          application/json: 
            Fn::Sub:
            - |
                #set($inputRoot = $input.path('$'))
                {
                  "input": "$util.escapeJavaScript($input.json('$')).replaceAll("\\'","'")",
                  "stateMachineArn": "${BlogReviewStateMachineArn}"
                }
            - BlogReviewStateMachineArn: 
                Fn::GetAtt: BlogReviewStateMachine.Arn
        passthroughBehavior: "when_no_templates"
        type: "aws"
components:
  securitySchemes:
    api_key:
      type: "apiKey"
      name: "x-api-key"
      in: "header"
```

### blog-review.asl.yamlã«ã¤ã„ã¦
Step Functionsã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³å®šç¾©ã§ã€ãƒ–ãƒ­ã‚°ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚
Bedrockã®å‘¼ã³å‡ºã—ãƒ¢ãƒ‡ãƒ«ã¯Step FunctionsãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å›ºæœ‰ã«ãªã‚Šã¾ã™ã€‚
(ä¾‹ï¼šæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼šStep Functionsã€€â†’ã€€ã‚ªãƒ¬ã‚´ãƒ³ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼šClaude 3.7 Sonnetã€€ã¯ä¸å¯)


#### å‡¦ç†ãƒ•ãƒ­ãƒ¼

#### Parallel Stateï¼ˆä¸¦åˆ—å‡¦ç†ï¼‰
2ã¤ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¹ã‚¯ã‚’åŒæ™‚ã«å®Ÿè¡Œï¼š

#### 1. ReviewBlogMediaPolicyï¼ˆãƒ¡ãƒ‡ã‚£ã‚¢ãƒãƒªã‚·ãƒ¼å¯©æŸ»ï¼‰
**ãƒã‚§ãƒƒã‚¯é …ç›®**ï¼š
ä¸€èˆ¬çš„ãªãƒ¡ãƒ‡ã‚£ã‚¢ãƒãƒªã‚·ãƒ¼ã‚’èª¿ã¹ã¦å…¥ã‚Œã¦ã„ã¾ã™ã€‚

**ä½¿ç”¨AIãƒ¢ãƒ‡ãƒ«**: Claude 3 Sonnet (Bedrock)
**å‡ºåŠ›å½¢å¼**: 
- å•é¡Œã‚ã‚Š: âŒã¨å…·ä½“çš„ãªå•é¡Œç‚¹
- å•é¡Œãªã—: âœ…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

#### 2. ReviewBlogTypoï¼ˆèª¤å­—è„±å­—ãƒã‚§ãƒƒã‚¯ï¼‰
**ãƒã‚§ãƒƒã‚¯é …ç›®**ï¼š
- èª¤å­—ãƒ»è„±å­—ã®æ¤œå‡º
- æ–‡æ³•ä¸Šã®å•é¡Œã®æŒ‡æ‘˜

**ä½¿ç”¨AIãƒ¢ãƒ‡ãƒ«**: Claude 3 Sonnet (Bedrock)
**å‡ºåŠ›å½¢å¼**:
- å•é¡Œã‚ã‚Š: âŒã¨ä¿®æ­£ææ¡ˆ
- å•é¡Œãªã—: âœ…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### çµæœã®é›†ç´„
ResultSelectorã§ä¸¡æ–¹ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’çµ±åˆï¼š
- mediaPolicy: ãƒ¡ãƒ‡ã‚£ã‚¢ãƒãƒªã‚·ãƒ¼ãƒã‚§ãƒƒã‚¯çµæœ
- typo: èª¤å­—è„±å­—ãƒã‚§ãƒƒã‚¯çµæœ


```yaml:blog-review.asl.yaml
Comment: (${Environment}) Zennã®ãƒ–ãƒ­ã‚°ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³
StartAt: Parallel
States:
  Parallel:
    Type: Parallel
    End: true
    Branches:
    - StartAt: ReviewBlogMediaPolicy
      States:
        ReviewBlogMediaPolicy:
          Type: Task
          Resource: arn:aws:states:::bedrock:invokeModel
          Parameters:
            ModelId: apac.anthropic.claude-3-7-sonnet-20250219-v1:0
            Body:
              anthropic_version: bedrock-2023-05-31
              max_tokens: 2000
              system: |
                ã‚ãªãŸã¯ä¼æ¥­ãƒ–ãƒ­ã‚°ã®ãƒ¡ãƒ‡ã‚£ã‚¢ãƒãƒªã‚·ãƒ¼å¯©æŸ»æ‹…å½“è€…ã§ã™ã€‚

                ä»¥ä¸‹ã®6ã¤ã®è¦³ç‚¹ã‹ã‚‰è¨˜äº‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€å•é¡ŒãŒã‚ã‚Œã°æŒ‡æ‘˜ã—ã¦ãã ã•ã„ï¼š

                ## ãƒã‚§ãƒƒã‚¯é …ç›®
                1. **æ©Ÿå¯†æƒ…å ±ãƒ»å€‹äººæƒ…å ±ã®é–‹ç¤º**: æ°åã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€é›»è©±ç•ªå·ã€ç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã€API ã‚­ãƒ¼ãªã©ã®æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹
                2. **è‘—ä½œæ¨©ä¾µå®³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æŠ•ç¨¿**: ä»–ç¤¾ã®è‘—ä½œç‰©ã€ç”»åƒã€ã‚³ãƒ¼ãƒ‰ã®ç„¡æ–­ä½¿ç”¨ãŒãªã„ã‹
                3. **è™šå½ã®æƒ…å ±ã®æ‹¡æ•£**: äº‹å®Ÿã¨ç•°ãªã‚‹æƒ…å ±ã€æ ¹æ‹ ã®ãªã„ä¸»å¼µã€èª¤è§£ã‚’æ‹›ãè¡¨ç¾ãŒãªã„ã‹
                4. **å·®åˆ¥çš„ãƒ»æ”»æ’ƒçš„ãªç™ºè¨€**: ç‰¹å®šã®å€‹äººãƒ»å›£ä½“ãƒ»å±æ€§ã«å¯¾ã™ã‚‹å·®åˆ¥çš„ãƒ»æ”»æ’ƒçš„ãªè¡¨ç¾ãŒãªã„ã‹
                5. **ç«¶åˆä»–ç¤¾ã¸ã®ä¸é©åˆ‡ãªè¨€åŠ**: ç«¶åˆä»–ç¤¾ã¸ã®èª¹è¬—ä¸­å‚·ã€ä¸å½“ãªæ‰¹åˆ¤ã€å–¶æ¥­å¦¨å®³ã«ã‚ãŸã‚‹è¡¨ç¾ãŒãªã„ã‹
                6. **æœªå…¬é–‹ã®è£½å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã®æ¼æ´©**: ç¤¾å†…é™å®šæƒ…å ±ã€æœªç™ºè¡¨ã®è£½å“æƒ…å ±ã€æ©Ÿå¯†ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ãªã©ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹

                ## å‡ºåŠ›å½¢å¼
                å•é¡ŒãŒè¦‹ã¤ã‹ã£ãŸå ´åˆï¼š
                ã€ŒâŒ å•é¡Œã‚’ç™ºè¦‹ã—ã¾ã—ãŸï¼š[å…·ä½“çš„ãªå•é¡Œç‚¹ã¨è©²å½“ç®‡æ‰€ã‚’æ˜è¨˜]ã€

                å•é¡ŒãŒãªã„å ´åˆï¼š
                ã€Œâœ… ãƒ¡ãƒ‡ã‚£ã‚¢ãƒãƒªã‚·ãƒ¼ã®è¦³ç‚¹ã‹ã‚‰å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€
              messages:
                - role: user
                  content:
                    - type: text
                      text.$: $.article
              temperature: 0
          OutputPath: $.Body.content[0].text
          End: true          
    - StartAt: ReviewBlogTypo
      States:
        ReviewBlogTypo:
          Type: Task
          Resource: arn:aws:states:::bedrock:invokeModel
          Parameters:
            ModelId: apac.anthropic.claude-3-7-sonnet-20250219-v1:0
            Body:
              anthropic_version: bedrock-2023-05-31
              max_tokens: 2000
              system: |
                ã‚ãªãŸã¯ä¼æ¥­ãƒ–ãƒ­ã‚°ã®æ ¡æ­£æ‹…å½“è€…ã§ã™ã€‚è¨˜äº‹ã®èª¤å­—ãƒ»è„±å­—ãƒ»æ–‡æ³•ä¸Šã®å•é¡Œã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

                ## å‡ºåŠ›å½¢å¼
                å•é¡ŒãŒè¦‹ã¤ã‹ã£ãŸå ´åˆï¼š
                ã€ŒâŒ ä»¥ä¸‹ã®ä¿®æ­£ãŒå¿…è¦ã§ã™ï¼š
                â€¢ [ä¿®æ­£å‰] â†’ [ä¿®æ­£å¾Œ] ([ç†ç”±])
                â€¢ [ä¿®æ­£å‰] â†’ [ä¿®æ­£å¾Œ] ([ç†ç”±])ã€

                å•é¡ŒãŒãªã„å ´åˆï¼š
                ã€Œâœ… èª¤å­—ãƒ»è„±å­—ãƒ»æ–‡æ³•ä¸Šã®å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€

              messages:
                - role: user
                  content:
                    - type: text
                      text.$: $.article
              temperature: 0
          OutputPath: $.Body.content[0].text
          End: true
    ResultSelector:
      mediaPolicy.$: States.ArrayGetItem($,0)
      typo.$: States.ArrayGetItem($,1)
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒ†ã‚¹ãƒˆ
ã“ã“ã¾ã§ä½œæˆã—ãŸã‚‰ã€`sam deploy`ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ã‚‡ã†ã€‚
ï¼ˆ`sam deploy --guided`ã¯å‰²æ„›ï¼‰

ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãŠãã“ã¨ã‚’å¿˜ã‚Œãšã«ã€‚

```
curl  'https://ï½˜ï½˜ï½˜ï½˜ï½˜ï½˜.execute-api.ap-northeast-1.amazonaws.com/dev/review' \
--header 'x-api-key: ï½˜ï½˜ï½˜ï½˜ï½˜ï½˜ï½˜ï½˜ï½˜' \
--header 'Content-Type: application/json' \
--data '{
    "article":"ä»Šæ—¥ã¯æœã‹ã‚‰å¿«æ™´ã§ã€è¡—ä¸­ã«ã¯æ´»æ°—ãŒã‚ãµã‚Œã¦ã„ãŸã€‚ã‚«ãƒ•ã‚§ã®å‰ã‚’é€šã‚‹ã¨ã€ã‚³ãƒ¼ãƒ’ãƒ¼ã®é¦™ã‚ŠãŒæ¼‚ã„ã€æ€ã‚ãšç«‹ã¡å¯„ã‚ŠãŸããªã‚‹ã€‚é€šå‹¤é€”ä¸­ã®äººã€…ã¯ãã‚Œãã‚Œã®ãƒšãƒ¼ã‚¹ã§æ­©ãã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’è¦‹ãŸã‚Šã€å‹äººã¨ä¼šè©±ã‚’æ¥½ã—ã‚“ã ã‚Šã—ã¦ã„ã‚‹ã€‚å…¬åœ’ã®ãƒ™ãƒ³ãƒã«ã¯èª­æ›¸ã‚’ã™ã‚‹äººã‚„æ•£æ­©ã‚’æ¥½ã—ã‚€çŠ¬é€£ã‚Œã®äººã€…ãŒã„ã¦ã€æ—¥å¸¸ã®ç©ã‚„ã‹ã•ãŒæ„Ÿã˜ã‚‰ã‚ŒãŸã€‚ãµã¨ç©ºã‚’è¦‹ä¸Šã’ã‚‹ã¨ã€é›²ã²ã¨ã¤ãªã„é’ç©ºãŒåºƒãŒã‚Šã€é ãã®å±±ä¸¦ã¿ãã£ãã‚Šã¨è¦‹ãˆã‚‹ã€‚ã“ã‚“ãªæ—¥ã«ã¯ã€ä»•äº‹ã‚„å‹‰å¼·ã®åˆé–“ã«å°‘ã—å¤–ã®ç©ºæ°—ã‚’å¸ã†ã ã‘ã§ã‚‚ã€æ°—æŒã¡ãŒãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ã“ã¨ã«æ°—ã¥ãã€‚"
}'
```

ã†ã¾ãã„ã‘ã°ä»¥ä¸‹ã®ã‚ˆã†ã«å›ç­”ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
```
{"typo":"âœ… èª¤å­—ãƒ»è„±å­—ãƒ»æ–‡æ³•ä¸Šã®å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“","mediaPolicy":"âœ… ãƒ¡ãƒ‡ã‚£ã‚¢ãƒãƒªã‚·ãƒ¼ã®è¦³ç‚¹ã‹ã‚‰å•é¡Œã‚ã‚Šã¾ã›ã‚“"}
```

è©¦ã—ã«ã‚ãˆã¦èª¤å­—ã‚’ã—ã¦ã¿ã¾ã—ãŸã€‚
ã†ã¾ãå›ç­”ã•ã‚Œã¦ã¾ã™ã­ã€‚
```
 {"typo":"âŒ ä»¥ä¸‹ã®ä¿®æ­£ãŒå¿…è¦ã§ã™ï¼š\nâ€¢ [ã‚«ãƒ•ã®å‰] â†’ [ã‚«ãƒ•ã‚§ã®å‰] (ã€Œã‚«ãƒ•ã‚§ã€ã®è¡¨è¨˜ãŒä¸å®Œå…¨ã§ã™)\nâ€¢ [å±±ä¸¦ã¿ãã£ãã‚Šã¨è¦‹ãˆã‚‹] â†’ [å±±ä¸¦ã¿ãŒãã£ãã‚Šã¨è¦‹ãˆã‚‹] (åŠ©è©ã€ŒãŒã€ãŒæŠœã‘ã¦ã„ã¾ã™)","mediaPolicy":"âœ… ãƒ¡ãƒ‡ã‚£ã‚¢ãƒãƒªã‚·ãƒ¼ã®è¦³ç‚¹ã‹ã‚‰å•é¡Œã‚ã‚Šã¾ã›ã‚“"}
```

ã“ã‚Œã§APIã¯å®Œäº†ã—ãŸã®ã§ã€æ¬¡ã«VScordã§æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œæˆã—ã¾ã™ã€‚

# VScordæ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®š
VScordæ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ä½œæˆã™ã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ã«ã€VScordã§APIãŒç°¡å˜ã«å®Ÿè¡Œã§ãã¾ã™ã€‚

  1. VSIXãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç›´æ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰
  cd zenn-review-extension
  code --install-extension zenn-blog-review-1.0.0.vsix

  ã¾ãŸã¯ VS Codeã§ï¼š
  - ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆCtrl+Shift+Pï¼‰
  - ã€ŒExtensions: Install from VSIX...ã€
  - zenn-blog-review-1.0.0.vsixã‚’é¸æŠ

  2. é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
  cd zenn-review-extension
  npm install
  npm run compile

  
  ã“ã®ã‚ˆã†ãªå½¢ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸï¼
![](https://storage.googleapis.com/zenn-user-upload/3dee5b30ba37-20250905.png)

# ãŠã‚ã‚Šã«
ãƒ–ãƒ­ã‚°ãƒ¬ãƒ“ãƒ¥ãƒ¼ã ã‘ã§ãªãã€ç¤¾å†…æ–‡æ›¸ã‚„ãƒ¬ãƒãƒ¼ãƒˆã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯ãªã©ã€ã•ã¾ã–ã¾ãªæ–‡ç« ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è‡ªå‹•åŒ–ã«ã‚‚å¿œç”¨ã—ã¦ã„ã‘ãŸã‚‰ã„ã„ãªã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚
AIã‚’ç¤¾å†…å¤–ã®DXã§æ´»ç”¨ã—ã¦ã„ããŸã„ã§ã™ã­ã€‚