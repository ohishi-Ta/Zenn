---
title: "ã€API Gatewayã€‘Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆã¨ã‚«ã‚¹ã‚¿ãƒ çµ±åˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®é•ã„"
emoji: "ğŸ˜"
type: "tech"
topics:
  - "aws"
  - "lambda"
  - "xxxxxxx"
published: true
published_at: "2025-05-26 18:01"
---

# ã¯ã˜ã‚ã«
API Gatewayã®Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’ä½¿ç”¨ã—ãŸã“ã¨ã¯ã‚ã‚Šã¾ã—ãŸãŒã€ã‚«ã‚¹ã‚¿ãƒ çµ±åˆã®å ´åˆã¯ã©ã®ã‚ˆã†ã«Lambdaã¸ãƒ‡ãƒ¼ã‚¿ãŒé€ã‚‰ã‚Œã‚‹ã®ã‹æ¤œè¨¼ã—ã¦ã¿ã¾ã—ãŸã€‚

# ã–ã£ãã‚Šã¨ãã‚Œãã‚Œã®é•ã„
## ã‚«ã‚¹ã‚¿ãƒ çµ±åˆï¼ˆéãƒ—ãƒ­ã‚­ã‚·çµ±åˆï¼‰
- çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆVelocity Template Language: VTLï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€Lambdaã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å†…å®¹ã‚’è‡ªç”±ã«å¤‰æ›ãƒ»æ§‹æˆã§ãã‚‹ã€‚
- ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ãªã„ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ãŒãã®ã¾ã¾é€ã‚‰ã‚Œã‚‹ã€‚ï¼ˆã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚„ãƒ˜ãƒƒãƒ€ãƒ¼ãŒæ¸¡ã‚‰ãªã„ï¼‰

## Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆ
- Lambdaã¸æ¸¡ã™ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒæ±ºã¾ã£ã¦ã„ã‚‹ãŒã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’ã—ãªãã¦ã‚‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®eventãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ã§ã‚ã‚‹ç¨‹åº¦æ§‹é€ åŒ–ã—ã¦ãã‚Œã‚‹ã€‚

:::message
â€»Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆã¸æ¸¡ã™ã€Œæ±ºã¾ã£ãŸæ§‹é€ ã€ã¯AWSã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã®ã§ã€ä¸‹è¨˜ã‚’å‚ç…§ãã ã•ã„ã€‚
    https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/set-up-lambda-proxy-integrations.html#api-gateway-simple-proxy-for-lambda-input-format

â€»Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆã¯å‡ºåŠ›ã«é–¢ã—ã¦ã‚‚æ§‹é€ ãŒæ±ºã¾ã£ã¦ã„ã¾ã™ã€‚
https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/set-up-lambda-proxy-integrations.html#api-gateway-simple-proxy-for-lambda-output-format
:::

ChatCPTã«ä¾‹ã‚’ã ã—ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚
HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®bodyã®éƒ¨åˆ†ã¯ã€Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆã§ã¯"body"ã«å…¥ã‚‹ã‚ã‘ã§ã™ã­ã€‚
![](https://storage.googleapis.com/zenn-user-upload/dc47669d3f2d-20250526.png)


# HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ã®ãã‚Œãã‚Œã®Lambdaã¸ã®æ¸¡ã—æ–¹ã®é•ã„
å…±é€šã®ã¨ã‚ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã€Œã‚«ã‚¹ã‚¿ãƒ çµ±åˆã€ã€ŒLambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆã€ã«é€ã£ãŸéš›ã«ã©ã®ã‚ˆã†ãªæ§‹é€ ä½“ã§Lambdaã«å±Šãã‹å®Ÿéš›ã«APIã‚’ä½œæˆã—ã€æ¯”è¼ƒã—ã¦ã¿ã¾ã™ã€‚

## å…±é€šã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- `URL ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`ï¼šuser
    - ä¾‹ï¼‰https://xxx.com/test?user=taro
- `ãƒªã‚¯ã‚¨ã‚¹ãƒˆbody`: message
    - ä¾‹ï¼‰{ "message" : "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚"}

## ã‚«ã‚¹ã‚¿ãƒ çµ±åˆï¼ˆéãƒ—ãƒ­ã‚­ã‚·çµ±åˆï¼‰
ã¾ãšã‚µãƒ³ãƒ—ãƒ«ã®Lambdaã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚
CloudWatch Logsã«`event`ã‚’å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
```py:lambda_handler
def lambda_handler(event, context):
    print("Received event:", event)
    return {
        'statusCode': 200,
        'body': 'Lambda received the event.'
    }
```

æ¬¡ã«API Gatewayã§REST APIã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚
ãƒ¡ã‚½ãƒƒãƒ‰ã‚¿ã‚¤ãƒ—ã¯`POST`ã€`Lambda ãƒ—ãƒ­ã‚­ã‚·çµ±åˆ`ã¯**ã‚ªãƒ•**ã«ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚
ã¾ãŸã€å…ˆã»ã©ä½œæˆã—ãŸLambdaã‚’æŒ‡å®šã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/314126cb6f1e-20250526.png)

æ¬¡ã«ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
`ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—`ã‚’ã€Œapplication/jsonã€ã«ã—ã¦ã€ä¸‹è¨˜ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚
```:VTL
{
  "username": "$input.params('user')",
  "message": $input.json('$.message')
}
```

ã“ã‚Œã§Lambdaã‚«ã‚¹ã‚¿ãƒ çµ±åˆï¼ˆéãƒ—ãƒ­ã‚­ã‚·çµ±åˆï¼‰ã®APIãŒå®Œæˆã—ã¾ã—ãŸã€‚
ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ä»¥ä¸‹ã‚’å®Ÿè¡Œã™ã‚‹ã—ã€CloudWatchã®ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã¨ã€
```
curl -X POST \
  'https://xxxxxxx.execute-api.ap-northeast-1.amazonaws.com/prod/custom-togo?user=taro' \
  -H 'content-type: application/json' \
  -d '{
	"message": "Hi!!"
}'
```

ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§æŒ‡å®šã—ãŸæ§‹é€ ã§Lambdaã«æ¸¡ã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/2234e0cd4935-20250526.png)

ã¡ãªã¿ã«ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æŒ‡å®šã—ãªã„ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆbodyã ã‘ãŒãã®ã¾ã¾é€ã‚‰ã‚Œã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/851d999c93c9-20250526.png)

## Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆ
å…ˆã»ã©ã¨åŒã˜ãã€APIã‚’ä½œã‚Šã¾ã™ã€‚
ä»Šå›ã¯`Lambda ãƒ—ãƒ­ã‚­ã‚·çµ±åˆ`ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
![](https://storage.googleapis.com/zenn-user-upload/f8317c0facf6-20250526.png)

ã“ã‚Œã ã‘ã§APIã®è¨­å®šã¯å®Œäº†ã§ã™ã€‚

ã§ã¯ãƒ†ã‚¹ãƒˆã—ã¦ã„ãã¾ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹åã ã‘å¤‰ãˆã¦ã€ä¸‹è¨˜ã‚’å®Ÿè¡Œã—ã¦ã„ãã¾ã™ã€‚
```
curl -X POST \
  'https://xxxxxxx.execute-api.ap-northeast-1.amazonaws.com/prod/proxy-togo?user=taro' \
  -H 'content-type: application/json' \
  -d '{
	"message": "Hi!!"
}'
```

CloudWatchã®ãƒ­ã‚°ã‚’è¦‹ã‚‹ã¨
æ˜ã‚‰ã‹ã«ã‚«ã‚¹ã‚¿ãƒ çµ±åˆã¨ã¯é•ã„ã¾ã™ã­ï¼
ç°¡å˜ã«å¤šãã®æƒ…å ±ã‚’æ‰±ã†ã“ã¨ãŒã§ããã†ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/766b3937bfb4-20250526.png)


# ãŠã‚ã‚Šã«
ä»¥ä¸Šã€ã‚«ã‚¹ã‚¿ãƒ çµ±åˆã¨ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã®Lambdaã¸ã®ãƒ‡ãƒ¼ã‚¿ã®æ¸¡ã—æ–¹ã®æ¯”è¼ƒã§ã—ãŸã€‚
ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’ä½¿ãˆã°ã‚µã‚¯ãƒƒã¨APIãŒä½œã‚Œã¦ã€ã‚·ãƒ³ãƒ—ãƒ«ãªAPIã‚’ä½¿ã†ã¨ãã«ã‚ˆã•ãã†ã§ã™ã­ã€‚
ä¸€æ–¹ã€ã‚«ã‚¹ã‚¿ãƒ çµ±åˆã¯ã‚ã‚‰ã‹ã˜ã‚Lambdaã¸æ¸¡ã™æ§‹é€ ãŒæ±ºã¾ã£ã¦ã„ã‚‹å ´åˆãªã©ã«ä½¿ã†å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚

# å‚è€ƒ
https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/set-up-lambda-proxy-integrations.html#api-gateway-simple-proxy-for-lambda-output-format
https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/models-mappings.html
https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/getting-started-lambda-non-proxy-integration.html
https://dev.classmethod.jp/articles/for-beginner-build-apigateway-with-noproxy-and-proxy-lambda/#note-514573-1
https://blog.usize-tech.com/aws-apigateway-lambda-proxy/